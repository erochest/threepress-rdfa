<a name="toc">&nbsp;</a>
{% if request.session.common.mobile %}
<p><a href="#bwmain">Read current page</a></p>
{% endif %}

{% if document.authors.all %}
<h2 class="bw-authors">
{% if request.session.common.mobile %}
{{ document.title }}
{% endif %}
by 
{% for a in document.authors.all %}
  {{ a }}{% if not forloop.last %}, {% endif %}
{% endfor %}
</h2>
{% endif %}

<ol class="bw-nav">
  <li class="bw-first">
  {% if chapter %}
  <a href="{% url library.views.view_document_metadata document.safe_title,document.key %}">Book information</a>
  {% else %}
  Book information
  {% endif %}
  </li>

  <li class="bw-first">
    <a href="{% url library.views.view document.safe_title,document.key %}">First page</a>
  </li>

{% for c in document.get_top_level_toc %}

   {# Is 'c' a top-level chapter? #}

   {% ifequal c.order chapter.order %}

     {% with c.find_descendants as find_children %}
       {% with c as current_chapter %}
         {% include "includes/subchapters.html" %}
       {% endwith %}
     {% endwith %}

   {% endifequal %}

   {# Instead is 'c' the parent of the viewed chapter? #}

   {% ifequal c.order parent_chapter.order %}
      {% with c.find_descendants as find_children %}
        {% with c as current_chapter %}
          {% include "includes/subchapters.html" %}
        {% endwith %}
      {% endwith %}
   {% endifequal %}

   {# Silly Django, no flexible 'else' #}
   {% ifnotequal parent_chapter c %}
     {% ifnotequal c.order chapter.order %}
       <li><a href="{% url library.views.view_chapter document.safe_title,document.key,c.href %}">{{ c.title }}</a></li>
       <!-- {% if request.session.common.mobile %}<span class="bw-mb-divider">~</span>{% endif %}    -->
     {% endifnotequal %}
   {% endifnotequal %}

{% endfor %}
</ol>

{% for l in document.get_toc.lists %}
 
  <h3>{{ l.title }}</h3>
  <ol class="bw-nav">
    {% for c in l.tree %}
    <li><a href="{% url library.views.view_chapter document.safe_title,document.key,c.href %}">{{ c.title }}</a></li>    
    {% endfor %}
  </ol>
{% endfor %}
