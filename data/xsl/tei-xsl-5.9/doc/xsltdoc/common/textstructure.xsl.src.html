
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><title>XML source view</title><link rel="stylesheet" type="text/css" href="../xmlverbatim.css"/></head><body class="xmlverb-default"><tt>
<!-- converted by xmlverbatim.xsl 1.1, (c) O. Becker -->
<div xmlns:xd="http://www.pnp-software.com/XSLTdoc" class="xmlverb-default">&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e1">stylesheet</a></span><span class="xmlverb-ns-name"> xmlns:xsl</span>="<span class="xmlverb-ns-uri">http://www.w3.org/1999/XSL/Transform</span>"<span class="xmlverb-ns-name"> xmlns:tei</span>="<span class="xmlverb-ns-uri">http://www.tei-c.org/ns/1.0</span>"<span class="xmlverb-ns-name"> xmlns:edate</span>="<span class="xmlverb-ns-uri">http://exslt.org/dates-and-times</span>"<span class="xmlverb-ns-name"> xmlns:xd</span>="<span class="xmlverb-ns-uri">http://www.pnp-software.com/XSLTdoc</span>" <span class="xmlverb-attr-name">exclude-result-prefixes</span>="<span class="xmlverb-attr-content">xd tei edate</span>" <span class="xmlverb-attr-name">extension-element-prefixes</span>="<span class="xmlverb-attr-content">edate</span>" <span class="xmlverb-attr-name">version</span>="<span class="xmlverb-attr-content">1.0</span>"&gt;<span class="xmlverb-text"><br/>
  </span><div class="xd">
  &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e3">doc</a></span> <span class="xmlverb-attr-name">type</span>="<span class="xmlverb-attr-content">stylesheet</span>"&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e5">short</a></span>&gt;<span class="xmlverb-text"> TEI stylesheet dealing with elements from the textstructure<br/>
      module. </span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">short</span>&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e8">detail</a></span>&gt;<span class="xmlverb-text"> This library is free software; you can redistribute it and/or<br/>
      modify it under the terms of the GNU Lesser General Public License as<br/>
      published by the Free Software Foundation; either version 2.1 of the<br/>
      License, or (at your option) any later version. This library is<br/>
      distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;<br/>
      without even the implied warranty of MERCHANTABILITY or FITNESS FOR A<br/>
      PARTICULAR PURPOSE. See the GNU Lesser General Public License for more<br/>
      details. You should have received a copy of the GNU Lesser General Public<br/>
      License along with this library; if not, write to the Free Software<br/>
      Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA </span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">detail</span>&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e11">author</a></span>&gt;<span class="xmlverb-text">See AUTHORS</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">author</span>&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e14">cvsId</a></span>&gt;<span class="xmlverb-text">$Id: textstructure.xsl 3695 2007-10-19 20:16:59Z jic7r $</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">cvsId</span>&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e17">copyright</a></span>&gt;<span class="xmlverb-text">2007, TEI Consortium</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">copyright</span>&gt;<span class="xmlverb-text"><br/>
  </span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br/>
  </span><div class="xd">
  &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e21">doc</a></span>&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e23">short</a></span>&gt;<span class="xmlverb-text">Establish nesting depth of sections</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">short</span>&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e26">detail</a></span>&gt;<span class="xmlverb-text"> </span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">detail</span>&gt;<span class="xmlverb-text"><br/>
  </span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br/>
  </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e30">template</a></span> <span class="xmlverb-attr-name">match</span>="<span class="xmlverb-attr-content">tei:div|tei:div0|tei:div1|tei:div2|tei:div3|tei:div4|tei:div5|tei:div6</span>" <span class="xmlverb-attr-name">mode</span>="<span class="xmlverb-attr-content">depth</span>"&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e32">choose</a></span>&gt;<span class="xmlverb-text"><br/>
      </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e34">when</a></span> <span class="xmlverb-attr-name">test</span>="<span class="xmlverb-attr-content">local-name(.) = 'div'</span>"&gt;<span class="xmlverb-text"><br/>
        </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e36">value-of</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">count(ancestor::tei:div)</span>" /&gt;<span class="xmlverb-text"><br/>
      </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">when</span>&gt;<span class="xmlverb-text"><br/>
      </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e39">otherwise</a></span>&gt;<span class="xmlverb-text"><br/>
        </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e41">choose</a></span>&gt;<span class="xmlverb-text"><br/>
          </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e43">when</a></span> <span class="xmlverb-attr-name">test</span>="<span class="xmlverb-attr-content">ancestor-or-self::tei:div0</span>"&gt;<span class="xmlverb-text"><br/>
            </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e45">value-of</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">substring-after(local-name(.),'div')</span>" /&gt;<span class="xmlverb-text"><br/>
          </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">when</span>&gt;<span class="xmlverb-text"><br/>
          </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e48">otherwise</a></span>&gt;<span class="xmlverb-text"><br/>
            </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e50">value-of</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">substring-after(local-name(.),'div') - 1</span>" /&gt;<span class="xmlverb-text"><br/>
          </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">otherwise</span>&gt;<span class="xmlverb-text"><br/>
        </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">choose</span>&gt;<span class="xmlverb-text"><br/>
      </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">otherwise</span>&gt;<span class="xmlverb-text"><br/>
    </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">choose</span>&gt;<span class="xmlverb-text"><br/>
  </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br/>
  </span><div class="xd">
  &lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e57">doc</a></span>&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e59">short</a></span>&gt;<span class="xmlverb-text">[common] Work out the number of a section </span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">short</span>&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e62">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">numbersuffix</span>"&gt;<span class="xmlverb-text">suffix to add after number (typically ". ")</span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">param</span>&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name"><a name="d24e65">detail</a></span>&gt;<span class="xmlverb-text"> </span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">detail</span>&gt;<span class="xmlverb-text"><br/>
  </span>&lt;/<span class="xmlverb-element-nsprefix">xd</span>:<span class="xmlverb-element-name">doc</span>&gt;</div><span class="xmlverb-text"><br/>
  </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e69">template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">calculateNumber</span>"&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e71">param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">numbersuffix</span>" /&gt;<span class="xmlverb-text"><br/>
    </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e73">choose</a></span>&gt;<span class="xmlverb-text"><br/>
      </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e75">when</a></span> <span class="xmlverb-attr-name">test</span>="<span class="xmlverb-attr-content">$prenumberedHeadings='true' and @n</span>"&gt;<span class="xmlverb-text"><br/>
        </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e77">value-of</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">@n</span>" /&gt;<span class="xmlverb-text"><br/>
        </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e79">value-of</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">$numbersuffix</span>" /&gt;<span class="xmlverb-text"><br/>
      </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">when</span>&gt;<span class="xmlverb-text"><br/>
      </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e82">when</a></span> <span class="xmlverb-attr-name">test</span>="<span class="xmlverb-attr-content">ancestor::tei:front</span>"&gt;<span class="xmlverb-text"><br/>
        </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e84">if</a></span> <span class="xmlverb-attr-name">test</span>="<span class="xmlverb-attr-content">not($numberFrontHeadings='')</span>"&gt;<span class="xmlverb-text"><br/>
          </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e86">number</a></span> <span class="xmlverb-attr-name">count</span>="<span class="xmlverb-attr-content">tei:div|tei:div0|tei:div1|tei:div2|tei:div3|tei:div4</span>" <span class="xmlverb-attr-name">format</span>="<span class="xmlverb-attr-content">{$numberFrontHeadings}</span>" <span class="xmlverb-attr-name">from</span>="<span class="xmlverb-attr-content">tei:front</span>" <span class="xmlverb-attr-name">level</span>="<span class="xmlverb-attr-content">multiple</span>" /&gt;<span class="xmlverb-text"><br/>
          </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e88">value-of</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">$numbersuffix</span>" /&gt;<span class="xmlverb-text"><br/>
        </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">if</span>&gt;<span class="xmlverb-text"><br/>
      </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">when</span>&gt;<span class="xmlverb-text"><br/>
      </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e92">when</a></span> <span class="xmlverb-attr-name">test</span>="<span class="xmlverb-attr-content">ancestor::tei:back</span>"&gt;<span class="xmlverb-text"><br/>
        </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e94">if</a></span> <span class="xmlverb-attr-name">test</span>="<span class="xmlverb-attr-content">not($numberBackHeadings='')</span>"&gt;<span class="xmlverb-text"><br/>
          </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e96">call-template</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">i18n</span>"&gt;<span class="xmlverb-text"><br/>
            </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e98">with-param</a></span> <span class="xmlverb-attr-name">name</span>="<span class="xmlverb-attr-content">word</span>"&gt;<span class="xmlverb-text">appendixWords</span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">with-param</span>&gt;<span class="xmlverb-text"><br/>
          </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">call-template</span>&gt;<span class="xmlverb-text"><br/>
          </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e102">text</a></span>&gt;<span class="xmlverb-text"> </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">text</span>&gt;<span class="xmlverb-text"><br/>
          </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e105">number</a></span> <span class="xmlverb-attr-name">count</span>="<span class="xmlverb-attr-content">tei:div|tei:div0|tei:div1|tei:div2|tei:div3|tei:div4</span>" <span class="xmlverb-attr-name">format</span>="<span class="xmlverb-attr-content">{$numberBackHeadings}</span>" <span class="xmlverb-attr-name">from</span>="<span class="xmlverb-attr-content">tei:back</span>" <span class="xmlverb-attr-name">level</span>="<span class="xmlverb-attr-content">multiple</span>" /&gt;<span class="xmlverb-text"><br/>
          </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e107">value-of</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">$numbersuffix</span>" /&gt;<span class="xmlverb-text"><br/>
        </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">if</span>&gt;<span class="xmlverb-text"><br/>
      </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">when</span>&gt;<span class="xmlverb-text"><br/>
      </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e111">otherwise</a></span>&gt;<span class="xmlverb-text"><br/>
        </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e113">number</a></span> <span class="xmlverb-attr-name">count</span>="<span class="xmlverb-attr-content">tei:div|tei:div0|tei:div1|tei:div2|tei:div3|tei:div4</span>" <span class="xmlverb-attr-name">from</span>="<span class="xmlverb-attr-content">tei:body</span>" <span class="xmlverb-attr-name">level</span>="<span class="xmlverb-attr-content">multiple</span>" /&gt;<span class="xmlverb-text"><br/>
        </span>&lt;<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name"><a name="d24e115">value-of</a></span> <span class="xmlverb-attr-name">select</span>="<span class="xmlverb-attr-content">$numbersuffix</span>" /&gt;<span class="xmlverb-text"><br/>
      </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">otherwise</span>&gt;<span class="xmlverb-text"><br/>
    </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">choose</span>&gt;<span class="xmlverb-text"><br/>
  </span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">template</span>&gt;<span class="xmlverb-text"><br/>
</span>&lt;/<span class="xmlverb-element-nsprefix">xsl</span>:<span class="xmlverb-element-name">stylesheet</span>&gt;<br/>
</div>
</tt><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>v
         </body></html>
